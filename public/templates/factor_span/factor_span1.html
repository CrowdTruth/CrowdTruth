<style type="text/css">.senval span:hover { background-color:silver; }
</style>
<h3>Select pairs of WORD PHRASES that together form a medical RELATION.</h3>

<div class="highlight-box">The following SENTENCE contains information about a given medical RELATION. First, decide if the RELATION given is indeed expressed in the SENTENCE.<br />
<br />
If you choose YES, highlight all the pairs of WORD PHRASES which can be put together to form the given RELATION, by clicking on the words in the SENTENCE below. In order to submit multiple pairs of WORD PHRASES, click the <img src="http://www.ancad.ro/wp-content/uploads/2013/12/plus-icon.png" width="20" /> icon next to the answer field.<br />
<br />
If you choose NO, give a brief motivation for your choice.</div>

<p style="color:#0000CD; border-style:dotted; border-color:black;"><em><span class="senval" id="senval" style="span:hover { background-color:silver; }">${sentence}</span></em></p>

<p>In the SENTENCE above, can you identify any WORD PHRASES that form a <span style="color:#0000CD;"><em>${relation}</em></span> relation?</p>

<p><input checked="checked" id="WPFound" name="WPFound" onclick="answersFound();" type="radio" value="Found" /> YES, the following WORD PHRASE(S) can be found:</p>

<div id="wordphrases">
<p id="P1"><input id="Q1" name="Q1" size="20" type="text" value="" /> <span style="color:#0000CD;"><em>${relation}</em></span> <input id="Q2" name="Q2" size="20" type="text" value="" /> <img height="20" id="BM1" name="BM1" onclick="minusButton(1);" src="http://www.ancad.ro/wp-content/uploads/2013/12/minus-icon.png" style="visibility:hidden;" type="image" width="20" /> <img height="20" id="BP1" name="BP1" onclick="plusButton(1);" src="http://www.ancad.ro/wp-content/uploads/2013/12/plus-icon.png" type="image" width="20" /><br />
<input id="nextWP1" name="nextWP1" type="checkbox" value="nextWP1" />Done with the first argument <input id="A1span" name="A1span" type="hidden" /> <input id="A2span" name="A2span" type="hidden" /></p>

<p id="P2" style="visibility:hidden;"><input id="Q3" name="Q3" size="20" type="text" value="" /> <span style="color:#0000CD;"><em>${relation}</em></span> <input id="Q4" name="Q4" size="20" type="text" value="" /> <img id="BM2" name="BM2" onclick="minusButton(2);" src="http://www.ancad.ro/wp-content/uploads/2013/12/minus-icon.png" type="image" width="20" /> <img height="20" id="BP2" name="BP2" onclick="plusButton(2);" src="http://www.ancad.ro/wp-content/uploads/2013/12/plus-icon.png" type="image" width="20" /><br />
<input id="nextWP2" name="nextWP2" type="checkbox" value="nextWP2" />Done with the first argument <input id="A3span" name="A3span" type="hidden" /> <input id="A4span" name="A3span" type="hidden" /></p>

<p id="P3" style="visibility:hidden;"><input id="Q5" name="Q5" size="20" type="text" value="" /> <span style="color:#0000CD;"><em>${relation}</em></span> <input id="Q6" name="Q6" size="20" type="text" value="" /> <img id="BM3" name="BM3" onclick="minusButton(3);" src="http://www.ancad.ro/wp-content/uploads/2013/12/minus-icon.png" type="image" width="20" /><br />
<input id="nextWP3" name="nextWP3" type="checkbox" value="nextWP3" />Done with the first argument <input id="A5span" name="A5span" type="hidden" /> <input id="A6span" name="A6span" type="hidden" /></p>
</div>

<p><input id="WPNotFound" name="WPFound" onclick="answersNotFound();" type="radio" value="NotFound" /> NO WORD PHRASES can be found in connection with the ${relation} relation.</p>

<p>Motivate your choice:<br />
<textarea cols="50" id="NotFoundReason" name="NotFoundReason" rows="5"></textarea></p>

<p><span id="relval" style="visibility:hidden;">${relation}</span> <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script> <script type="text/javascript">
			
			var answers = 1;
			var colors = new Array("yellow", "orange", "greenyellow", "aqua", "bisque", "plum");
			
			selectedIds11 = new Array();
			selectedIds12 = new Array();
			
			inputFirstFactor1 = new Array();
			inputSecondFactor1 = new Array();
			checkboxDone1 = new Array();
			
			for (var i = 0; i < 3; i++) {
				var ina = i * 2 + 1;
				var inb = ina + 1;
				inputFirstFactor1[i] = document.getElementById("Q" + ina);
				inputSecondFactor1[i] = document.getElementById("Q" + inb);
				
				var j = i + 1;
				checkboxDone1[i] = document.getElementById("nextWP" + j);
			}

			function plusButton(i) {
				if (document.getElementById("WPFound").checked) {
				   // alert(answers);
				   
				   var a = document.getElementById("BP" + answers);
				   a.setAttribute("style", "visibility:hidden;");
				   if (answers == 1) {
					  var b = document.getElementById("BM1");
					  b.setAttribute("style", "visibility:visible;");
				   }
				   checkboxDone1[answers - 1].readOnly = true;
				   
				   var a = answers * 2 - 1;
				   var b = a + 1;
				   //alert(a + "\n" + b);
				   document.getElementById("A" + a + "span").value = selectedIds11[answers - 1].toString();
				   document.getElementById("A" + b + "span").value = selectedIds12[answers - 1].toString();
				   //alert(document.getElementById("A" + a + "span").value + "\n" + document.getElementById("A" + b + "span").value);
				   
				   answers++;
				   var x = document.getElementById("P" + answers);
				   x.setAttribute("style", "visibility:visible;");
				   
				   if (answers == 2) {
					  var q = document.getElementById("BP2");
					  q.setAttribute("style", "visibility:visible;");
				   }
			   }
			}
					 
			function minusButton(i) {
				// alert(answers);
				
				for (var j = i; j < 3; j++) {
					var a = j * 2 - 1;
					var b = a + 1;
					var c = b + 1;
					var d = c + 1;
					
					var qa = document.getElementById("Q" + a);
					var qb = document.getElementById("Q" + b);
					var qc = document.getElementById("Q" + c);
					var qd = document.getElementById("Q" + d);
					
					qa.value = qc.value;
					qb.value = qd.value;
					
					selectedIds11[j - 1] = selectedIds11[j];
					selectedIds12[j - 1] = selectedIds12[j];
					
					//alert(a + "\n" + b + "\n" + c + "\n" + d);
					document.getElementById("A" + a + "span").value = selectedIds11[j - 1].toString();
	   			    document.getElementById("A" + b + "span").value = selectedIds12[j - 1].toString();
				}
				
			   var a = answers * 2 - 1;
			   var b = answers * 2;
			   document.getElementById("Q" + a).value = "";
			   document.getElementById("Q" + b).value = "";
			   checkboxDone1[answers - 1].readOnly = false;
			   checkboxDone1[answers - 1].checked = false;
			   selectedIds11[answers - 1] = new Array();
			   selectedIds12[answers - 1] = new Array();
			   document.getElementById("A" + a + "span").value = "";
			   document.getElementById("A" + b + "span").value = "";
			   
			   var x = document.getElementById("P" + answers);
			   x.setAttribute("style", "visibility:hidden;");
			   
			   answers--;
			   var y = document.getElementById("BP" + answers);
			   y.setAttribute("style", "visibility:visible;");
			   
			   if (answers == 1) {
			      var q = document.getElementById("BM1");
			      q.setAttribute("style", "visibility:hidden;");
			      
			      var z = document.getElementById("BP2");
			      z.setAttribute("style", "visibility:hidden;");
			   }
			   checkboxDone1[answers - 1].readOnly = false;
			   checkboxDone1[answers - 1].checked = false;
			   
			   recolor();
			}
			
			
			
			sentence = document.getElementById("senval");
			// spansSelected = document.getElementById("selections");
			
			(function($){function injector(t,splitter,klass,after){var a=t.text().split(splitter),inject='';if(a.length){$(a).each(function(i,item){inject+='<span class="'+klass+(i+1)+'">'+item+'</span>'+after});t.empty().append(inject)}}var methods={init:function(){return this.each(function(){injector($(this),'','char','')})},words:function(){return this.each(function(){injector($(this),' ','word',' ')})},lines:function(){return this.each(function(){var r="eefec303079ad17405c889e092e105b0";injector($(this).children("br").replaceWith(r).end(),r,'line','')})}};$.fn.lettering=function(method){if(method&&methods[method]){return methods[method].apply(this,[].slice.call(arguments,1))}else if(method==='letters'||!method){return methods.init.apply(this,[].slice.call(arguments,0))}$.error('Method '+method+' does not exist on jQuery.lettering');return this}})(jQuery);
			   
			Array.prototype.remove = function(x) {
				for(i in this){
					if(this[i].toString() == x.toString()){
						this.splice(i,1)
					}
				}
			}
			  
			// this code dynamically reformats the rows' labels to accomodate the quantity of text rendered in the rows' data cells
			$(document).ready(function(){
			  $("#senval").lettering('words');
			  inputFirstFactor1[0].readOnly = true;
			  inputSecondFactor1[0].readOnly = true;
			  inputFirstFactor1[1].readOnly = true;
			  inputSecondFactor1[1].readOnly = true;
			  inputFirstFactor1[2].readOnly = true;
			  inputSecondFactor1[2].readOnly = true;
			  // give ids for each word (position in sentence)
			  var spans = $("#senval").find("span").each(function() {
				var idNumber = $(this).attr("class").slice(4);
				$(this).attr("id", idNumber);
			  });
			  $("#NotFoundReason").prop("disabled", true);
			});
			 
			for (var j = 0; j < 3; j ++) {
			  selectedIds11[j] = new Array();
			  selectedIds12[j] = new Array();
			 }
			 
			  sentence.onclick = function( event ) {
				index = answers - 1;
				
				var col1 = colors[index * 2];
				var col2 = colors[index * 2 + 1];
				//alert(isNaN(event.target.id));
				
				if (document.getElementById("WPFound").checked) {
					if (isNaN(event.target.id) == false) {
						if(event.target.nodeName == "SPAN") {
						  if(checkboxDone1[index].checked == false) {
							if (event.target.style.backgroundColor != col1) {
							  if (event.target.style.backgroundColor == col2) {
								selectedIds11[index].remove(event.target.id);
							   
								if (checkSpanDifference(selectedIds11[index]) <= 3) {
								  selection1 = updateHighlightedWords(selectedIds11[index]);
								  inputFirstFactor1[index].value = selection1;
								  
								  var newcol = "white";
								  for (var i = 0; i < index; i++) {
								  	if (selectedIds11[i].indexOf(parseInt(event.target.id)) != -1) {
								  		newcol = colors[i * 2 + 1];
								  	}
								  	if (selectedIds12[i].indexOf(parseInt(event.target.id)) != -1) {
								  		newcol = colors[i * 2];
								  	}
								  }
								  event.target.style.backgroundColor = newcol;
								}
								else {
								  selectedIds11[index].push(event.target.id);
								}
							  }
							  else {
								selectedIds11[index].push(parseInt(event.target.id));
								if (checkSpanDifference(selectedIds11[index]) <= 3) {
								  event.target.style.backgroundColor = col2;
								  selection1 = updateHighlightedWords(selectedIds11[index]);
								  inputFirstFactor1[index].value = selection1;
								}
								else {
								  selectedIds11[index].remove(parseInt(event.target.id));
								}
							  }
							}
						
							var a = answers * 2 - 1;
						    document.getElementById("A" + a + "span").value = selectedIds11[index].toString();
						    
						  }
						  else {
							if (event.target.style.backgroundColor != col2) {
							  if (event.target.style.backgroundColor == col1) {
								selectedIds12[index].remove(event.target.id);
								if (checkSpanDifference(selectedIds12[index]) <= 3) {
								  var selection2 = updateHighlightedWords(selectedIds12[index]);
								  inputSecondFactor1[index].value = selection2;
								  
								  var newcol = "white";
								  for (var i = 0; i < index; i++) {
								  	if (selectedIds11[i].indexOf(parseInt(event.target.id)) != -1) {
								  		newcol = colors[i * 2 + 1];
								  	}
								  	if (selectedIds12[i].indexOf(parseInt(event.target.id)) != -1) {
								  		newcol = colors[i * 2];
								  	}
								  }
								  event.target.style.backgroundColor = newcol;
								}
								else {
								  selectedIds12[index].push(event.target.id);
								}
							  }
							  else {
								selectedIds12[index].push(parseInt(event.target.id));
								if (checkSpanDifference(selectedIds12[index]) <= 3) {
								  event.target.style.backgroundColor = col1;
								  var selection2 = updateHighlightedWords(selectedIds12[index]);
								  inputSecondFactor1[index].value = selection2;
								}
								else {
								  selectedIds12[index].remove(parseInt(event.target.id));
								}
							  }
							}
						
					   		var b = answers * 2;
					   		document.getElementById("A" + b + "span").value = selectedIds12[index].toString();
						  }
						}
				  	}
				  }
			  }
			  
			function updateHighlightedWords(arrayId) {
			  arrayId.sort(function(a, b) {
				if (isNaN(a) || isNaN(b)) {
				  if (a > b) return 1;
				  else return -1;
				}
				return a - b;
			  });
			  
			  var selection2 = "";
			  for (var i = 0; i < arrayId.length; i ++) {
				var num = parseInt(arrayId[i]);
				var n = num.toString();
				selection2 += document.getElementById(n).innerHTML + " ";
			  }
			  
			  return selection2;
			}

			function checkSpanDifference(arrayId) {
			  arrayId.sort(function(a, b) {
				if (isNaN(a) || isNaN(b)) {
				  if (a > b) return 1;
				  else return -1;
				}
				return a - b;
			  });
			  
			  var max = 0;
			  for (var i = 0; i < arrayId.length -1; i ++) {
				if (parseInt(arrayId[i + 1]) - parseInt(arrayId[i]) > max)
				  max = parseInt(arrayId[i + 1]) - parseInt(arrayId[i]);
			  }
			  return max - 1 ;
			}
			
			function recolor() {
			  $("#senval").find("span").each(function() {
				var id = $(this).attr("id");
				var newcol = "white";
				for (var i = 0; i < 3; i++) {
					if (selectedIds11[i].indexOf(parseInt(id)) != -1) {
						newcol = colors[i * 2 + 1];
					}
					if (selectedIds12[i].indexOf(parseInt(id)) != -1) {
						newcol = colors[i * 2];
					}
				}
				$(this).css("background-color", newcol);
			  });
			}
			
			function answersNotFound() {
				$('#NotFoundReason').prop('disabled', false);
				
			  inputFirstFactor1[0].value = "";
			  inputSecondFactor1[0].value = "";
			  inputFirstFactor1[1].value = "";
			  inputSecondFactor1[1].value = "";
			  inputFirstFactor1[2].value = "";
			  inputSecondFactor1[2].value = "";
			  
			  selectedIds11[0] = new Array();
			  selectedIds12[0] = new Array();
			  selectedIds11[1] = new Array();
			  selectedIds12[1] = new Array();
			  selectedIds11[2] = new Array();
			  selectedIds12[2] = new Array();
			  
			  $("#senval").find("span").css("background-color", "white");
			  
			  document.getElementById("P2").setAttribute("style", "visibility:hidden;");
			  document.getElementById("P3").setAttribute("style", "visibility:hidden;");
			  document.getElementById("BM1").setAttribute("style", "visibility:hidden;");
			  document.getElementById("BP2").setAttribute("style", "visibility:hidden;");
			  document.getElementById("BP1").setAttribute("style", "visibility:visible;");
			  
			  checkboxDone1[0].checked = false;
			  checkboxDone1[0].readOnly = true;
			  checkboxDone1[1].checked = false;
			  checkboxDone1[1].readOnly = true;
			  checkboxDone1[2].checked = false;
			  checkboxDone1[2].readOnly = true;
			  
			  answers = 1;
			}
			
			function answersFound() {
				$('#NotFoundReason').prop('disabled', true);
				$('#NotFoundReason').val("");
			}

		</script></p>
